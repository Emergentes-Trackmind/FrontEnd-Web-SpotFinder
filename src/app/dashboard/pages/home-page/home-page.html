<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1 class="page-title">Dashboard</h1>
    <div class="header-actions">
      <button mat-icon-button (click)="onRefreshData()" matTooltip="Actualizar datos">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button (click)="onSearch()" matTooltip="Buscar">
        <mat-icon>search</mat-icon>
      </button>
      <button mat-icon-button (click)="onNotifications()" matTooltip="Notificaciones" matBadge="3" matBadgeColor="warn">
        <mat-icon>notifications</mat-icon>
      </button>
      <button mat-icon-button (click)="onProfile()" matTooltip="Perfil">
        <mat-icon>account_circle</mat-icon>
      </button>
    </div>
  </div>

  <!-- Loading Progress Bar -->
  <mat-progress-bar mode="indeterminate" *ngIf="loading | async" class="loading-bar"></mat-progress-bar>

  <!-- KPI Cards Row -->
  <div class="kpi-section">
    <div class="kpi-grid">
      <div *ngFor="let kpi of kpiCards()" class="kpi-item kpi-card">
        <div class="kpi-icon" [style.background-color]="kpi.color">
          <mat-icon>{{ kpi.icon }}</mat-icon>
        </div>
        <div class="kpi-content">
          <h3 class="kpi-title">{{ kpi.title }}</h3>
          <p class="kpi-value">{{ kpi.value }}</p>
          <span class="kpi-delta" [ngClass]="'delta-' + kpi.deltaType">{{ kpi.delta }}</span>
        </div>
        <div *ngIf="kpi.loading" class="kpi-loading">
          <mat-progress-spinner diameter="20"></mat-progress-spinner>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="charts-section">
    <div class="charts-grid">
      <!-- Revenue Chart -->
      <div class="chart-item chart-card">
        <h3 class="chart-title">Ingresos por Mes</h3>
        <div class="chart-content" *ngIf="revenueByMonth().length > 0; else noRevenueData">
          <div class="revenue-chart">
            <div *ngFor="let item of revenueByMonth()" class="revenue-bar">
              <div class="bar-label">{{ item.month }}</div>
              <div class="bar-container">
                <div class="bar" [style.height.%]="getRevenuePercentage(item.revenue)"></div>
              </div>
              <div class="bar-value">{{ item.currency }}{{ item.revenue | number }}</div>
            </div>
          </div>
        </div>
        <ng-template #noRevenueData>
          <div class="no-data">
            <mat-icon>show_chart</mat-icon>
            <p>No hay datos de ingresos disponibles</p>
          </div>
        </ng-template>
      </div>

      <!-- Occupancy Chart -->
      <div class="chart-item chart-card">
        <h3 class="chart-title">Ocupación por Hora</h3>
        <div class="chart-content" *ngIf="occupancyByHour().length > 0; else noOccupancyData">
          <div class="occupancy-chart">
            <div *ngFor="let item of occupancyByHour()" class="occupancy-bar">
              <div class="hour-label">{{ item.hour }}:00</div>
              <div class="occupancy-container">
                <div class="occupancy-bar-fill" [style.width.%]="item.percentage"></div>
              </div>
              <div class="occupancy-value">{{ item.percentage }}%</div>
            </div>
          </div>
        </div>
        <ng-template #noOccupancyData>
          <div class="no-data">
            <mat-icon>access_time</mat-icon>
            <p>No hay datos de ocupación disponibles</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Lists Row -->
  <div class="lists-section">
    <div class="lists-grid">
      <!-- Recent Activity -->
      <div class="list-item activity-card">
        <h3 class="list-title">Actividad Reciente</h3>
        <div class="activity-content" *ngIf="recentActivity().length > 0; else noActivityData">
          <div *ngFor="let activity of recentActivity()" class="activity-item">
            <div class="activity-icon">
              <mat-icon>{{ getActivityIcon(activity.type) }}</mat-icon>
            </div>
            <div class="activity-details">
              <h4 class="activity-title">{{ activity.title }}</h4>
              <p class="activity-description">{{ activity.description }}</p>
              <span class="activity-user">{{ activity.userName }}</span>
              <span class="activity-time">{{ activity.createdAt | date:'short' }}</span>
            </div>
            <div class="activity-status" [ngClass]="'status-' + activity.status">
              {{ getStatusText(activity.status) }}
            </div>
          </div>
        </div>
        <ng-template #noActivityData>
          <div class="no-data">
            <mat-icon>history</mat-icon>
            <p>No hay actividad reciente</p>
          </div>
        </ng-template>
      </div>

      <!-- Top Parkings -->
      <div class="list-item parkings-card">
        <h3 class="list-title">Top Parkings</h3>
        <div class="parkings-content" *ngIf="topParkings().length > 0; else noParkingsData">
          <div *ngFor="let parking of topParkings(); let i = index" class="parking-item">
            <div class="parking-rank">
              <span class="rank-number">{{ i + 1 }}</span>
            </div>
            <div class="parking-info">
              <h4 class="parking-name">{{ parking.name }}</h4>
              <p class="parking-address">{{ parking.address }}</p>
              <div class="parking-metrics">
                <span class="occupancy">{{ parking.occupancyPercentage }}% ocupado</span>
                <span class="rating">★ {{ parking.rating }}</span>
                <span class="revenue">{{ parking.currency }}{{ parking.monthlyRevenue | number }}</span>
              </div>
            </div>
            <div class="parking-status" [ngClass]="'status-' + parking.status">
              {{ getStatusText(parking.status) }}
            </div>
          </div>
        </div>
        <ng-template #noParkingsData>
          <div class="no-data">
            <mat-icon>local_parking</mat-icon>
            <p>No hay datos de parkings disponibles</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
