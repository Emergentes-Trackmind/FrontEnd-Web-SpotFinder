<mat-card class="step-card">
  <mat-card-header class="step-header">
    <mat-card-title>{{ 'PARKING_STEPS.FEATURES.TITLE' | translate }}</mat-card-title>
    <mat-card-subtitle>{{ 'PARKING_STEPS.FEATURES.SUBTITLE' | translate }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="step-content">
    <form [formGroup]="featuresForm" class="features-form">

      <!-- Resumen de selección -->
      <div class="selection-summary" *ngIf="getTotalSelectedFeatures() > 0">
        <mat-icon>check_circle</mat-icon>
        <span>{{ getTotalSelectedFeatures() }} {{ 'PARKING_STEPS.FEATURES.SELECTED_LABEL' | translate }}</span>
      </div>

      <!-- Categorías de características -->
      <div class="categories-grid">

        <!-- Seguridad -->
        <div class="category-section" formGroupName="security">
          <div class="category-header">
            <div class="category-title">
              <mat-icon class="category-icon security">{{ featureCategories.security.icon }}</mat-icon>
              <h3>{{ featureCategories.security.title }}</h3>
            </div>

            <div class="category-actions">
              <span class="selection-count" *ngIf="getSelectedFeaturesCount('security') > 0">
                {{ getSelectedFeaturesCount('security') }} {{ 'PARKING_STEPS.FEATURES.SELECTED' | translate }}
              </span>
              <button
                mat-button
                type="button"
                (click)="selectAllInCategory('security')"
                class="select-all-btn">
                {{ 'PARKING_STEPS.FEATURES.SELECT_ALL' | translate }}
              </button>
            </div>
          </div>

          <div class="features-list">
            <div *ngFor="let feature of featureCategories.security.features" class="feature-item">
              <mat-checkbox [formControlName]="feature.key" class="feature-checkbox">
                <div class="feature-content">
                  <span class="feature-label">{{ feature.label }}</span>
                  <span class="feature-description">{{ feature.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </div>
        </div>

        <!-- Comodidades -->
        <div class="category-section" formGroupName="amenities">
          <div class="category-header">
            <div class="category-title">
              <mat-icon class="category-icon amenities">{{ featureCategories.amenities.icon }}</mat-icon>
              <h3>{{ featureCategories.amenities.title }}</h3>
            </div>

            <div class="category-actions">
              <span class="selection-count" *ngIf="getSelectedFeaturesCount('amenities') > 0">
                {{ getSelectedFeaturesCount('amenities') }} {{ 'PARKING_STEPS.FEATURES.SELECTED' | translate }}
              </span>
              <button
                mat-button
                type="button"
                (click)="selectAllInCategory('amenities')"
                class="select-all-btn">
                {{ 'PARKING_STEPS.FEATURES.SELECT_ALL' | translate }}
              </button>
            </div>
          </div>

          <div class="features-list">
            <div *ngFor="let feature of featureCategories.amenities.features" class="feature-item">
              <mat-checkbox [formControlName]="feature.key" class="feature-checkbox">
                <div class="feature-content">
                  <span class="feature-label">{{ feature.label }}</span>
                  <span class="feature-description">{{ feature.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </div>
        </div>

        <!-- Servicios -->
        <div class="category-section" formGroupName="services">
          <div class="category-header">
            <div class="category-title">
              <mat-icon class="category-icon services">{{ featureCategories.services.icon }}</mat-icon>
              <h3>{{ featureCategories.services.title }}</h3>
            </div>

            <div class="category-actions">
              <span class="selection-count" *ngIf="getSelectedFeaturesCount('services') > 0">
                {{ getSelectedFeaturesCount('services') }} {{ 'PARKING_STEPS.FEATURES.SELECTED' | translate }}
              </span>
              <button
                mat-button
                type="button"
                (click)="selectAllInCategory('services')"
                class="select-all-btn">
                {{ 'PARKING_STEPS.FEATURES.SELECT_ALL' | translate }}
              </button>
            </div>
          </div>

          <div class="features-list">
            <div *ngFor="let feature of featureCategories.services.features" class="feature-item">
              <mat-checkbox [formControlName]="feature.key" class="feature-checkbox">
                <div class="feature-content">
                  <span class="feature-label">{{ feature.label }}</span>
                  <span class="feature-description">{{ feature.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </div>
        </div>

        <!-- Pagos -->
        <div class="category-section" formGroupName="payments">
          <div class="category-header">
            <div class="category-title">
              <mat-icon class="category-icon payments">{{ featureCategories.payments.icon }}</mat-icon>
              <h3>{{ featureCategories.payments.title }}</h3>
            </div>

            <div class="category-actions">
              <span class="selection-count" *ngIf="getSelectedFeaturesCount('payments') > 0">
                {{ getSelectedFeaturesCount('payments') }} {{ 'PARKING_STEPS.FEATURES.SELECTED' | translate }}
              </span>
              <button
                mat-button
                type="button"
                (click)="selectAllInCategory('payments')"
                class="select-all-btn">
                {{ 'PARKING_STEPS.FEATURES.SELECT_ALL' | translate }}
              </button>
            </div>
          </div>

          <div class="features-list">
            <div *ngFor="let feature of featureCategories.payments.features" class="feature-item">
              <mat-checkbox [formControlName]="feature.key" class="feature-checkbox">
                <div class="feature-content">
                  <span class="feature-label">{{ feature.label }}</span>
                  <span class="feature-description">{{ feature.description }}</span>
                </div>
              </mat-checkbox>
            </div>
          </div>
        </div>

      </div>

      <!-- Mensaje cuando no hay características seleccionadas -->
      <div class="no-selection-message" *ngIf="getTotalSelectedFeatures() === 0">
        <mat-icon>info</mat-icon>
        <p>{{ 'PARKING_STEPS.FEATURES.NO_SELECTION' | translate }}</p>
        <small>{{ 'PARKING_STEPS.FEATURES.NO_SELECTION_HINT' | translate }}</small>
      </div>

    </form>
  </mat-card-content>
</mat-card>
