<div class="parking-list-container">
  <!-- Header -->
  <div class="header">
    <div class="title-section">
      <h1 class="page-title">Mis Parkings</h1>
      <p class="page-subtitle">Selecciona un parking para editar su información</p>
    </div>

    <!-- Acciones -->
    <div class="actions-section">
      <!-- Botón Nuevo Parking con límites -->
      <button
        mat-raised-button
        color="primary"
        (click)="onNewParking()"
        [matTooltip]="newParkingTooltip"
        [disabled]="!canCreateParking"
        class="new-parking-btn">
        <mat-icon>add</mat-icon>
        Nuevo Parking
      </button>

      <!-- Botón de eliminar múltiple -->
      <button
        mat-raised-button
        color="warn"
        [disabled]="!canDelete"
        (click)="onDeleteSelected()"
        class="delete-multiple-btn"
        [attr.aria-label]="'Eliminar ' + selectedCount + ' parkings seleccionados'">
        <mat-icon>delete</mat-icon>
        Eliminar parking{{ selectedCount > 1 ? 's' : '' }}
      </button>
    </div>
  </div>

  <!-- ARIA Live region para anuncios -->
  <div
    id="selection-announcer"
    class="sr-only"
    role="status"
    aria-live="polite"
    aria-atomic="true">
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput
             placeholder="Buscar parking..."
             [formControl]="searchControl">
    </mat-form-field>
  </div>

  <!-- Modo selección indicator -->
  <div *ngIf="isSelectionMode" class="selection-mode-banner">
    <mat-icon>check_circle</mat-icon>
    <span>Modo selección activo - {{ selectedCount }} seleccionado{{ selectedCount !== 1 ? 's' : '' }}</span>
    <button mat-button (click)="exitSelectionMode()">
      <mat-icon>close</mat-icon>
      Salir
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando parkings...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="hasError && !isLoading" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h3>Error al cargar los parkings</h3>
    <p>No se pudieron cargar los datos. Inténtalo de nuevo.</p>
    <button mat-button color="primary" (click)="onRetry()">
      <mat-icon>refresh</mat-icon>
      Reintentar
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && !hasError && filteredParkings.length === 0 && parkings.length === 0" class="empty-container">
    <mat-icon class="empty-icon">local_parking</mat-icon>
    <h3>Sin parkings registrados</h3>
    <p>Aún no tienes ningún parking registrado. ¡Crea tu primer parking!</p>
    <button mat-raised-button color="primary" (click)="onNewParking()">
      <mat-icon>add</mat-icon>
      Nuevo Parking
    </button>
  </div>

  <!-- No Search Results -->
  <div *ngIf="!isLoading && !hasError && filteredParkings.length === 0 && parkings.length > 0" class="no-results-container">
    <mat-icon class="no-results-icon">search_off</mat-icon>
    <h3>Sin resultados</h3>
    <p>No se encontraron parkings que coincidan con tu búsqueda.</p>
    <button mat-button color="primary" (click)="searchControl.setValue('')">
      <mat-icon>clear</mat-icon>
      Limpiar búsqueda
    </button>
  </div>

  <!-- Parking Grid -->
  <div *ngIf="!isLoading && !hasError && filteredParkings.length > 0" class="parking-grid">
    <div
      *ngFor="let parking of filteredParkings; trackBy: trackByParkingId"
      class="parking-card-wrapper"
      [class.selected]="isParkingSelected(parking.id)"
      (mousedown)="onParkingPressStart(parking.id, $event)"
      (mouseup)="onParkingPressEnd()"
      (mouseleave)="onParkingPressEnd()"
      (touchstart)="onParkingPressStart(parking.id, $event)"
      (touchend)="onParkingPressEnd()"
      (touchcancel)="onParkingPressEnd()"
      (click)="onParkingClick(parking.id, $event)"
      (keydown)="onParkingKeydown(parking.id, $event)"
      [attr.tabindex]="isSelectionMode ? 0 : -1"
      [attr.role]="isSelectionMode ? 'checkbox' : null"
      [attr.aria-checked]="isSelectionMode ? isParkingSelected(parking.id) : null"
      [attr.aria-label]="parking.name + (isSelectionMode ? (isParkingSelected(parking.id) ? ' - seleccionado' : ' - no seleccionado') : '')">

      <app-parking-card
        [parking]="parking"
        (deleteParking)="onDeleteParking($event)">
      </app-parking-card>

      <!-- Indicador de selección -->
      <div *ngIf="isSelectionMode && isParkingSelected(parking.id)" class="selection-indicator">
        <mat-icon>check_circle</mat-icon>
      </div>
    </div>
  </div>
</div>
